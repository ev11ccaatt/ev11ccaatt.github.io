
<!DOCTYPE html>
<html>
  <head>
    
<meta charset="utf-8" >

<title>DC-9  | ev11ccaatt</title>
<meta name="description" content="人菜多学">

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.0/animate.min.css">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://ev11ccaatt.github.io/favicon.ico?v=1619600409962">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://ev11ccaatt.github.io/styles/main.css">



<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>



  </head>
  <body>
    <div id="app" class="main">
      <div class="site-header-container">
  <div class="site-header">
    <div class="left">
      <a href="https://ev11ccaatt.github.io">
        <img class="avatar" src="https://ev11ccaatt.github.io/images/avatar.png?v=1619600409962" alt="" width="32px" height="32px">
      </a>
      <a href="https://ev11ccaatt.github.io">
        <h1 class="site-title">ev11ccaatt</h1>
      </a>
    </div>
    <div class="right">
      <transition name="fade">
        <i class="icon" :class="{ 'icon-close-outline': menuVisible, 'icon-menu-outline': !menuVisible }" @click="menuVisible = !menuVisible"></i>
      </transition>
    </div>
  </div>
</div>

<transition name="fade">
  <div class="menu-container" style="display: none;" v-show="menuVisible">
    <div class="menu-list">
      
        
          <a href="/" class="menu purple-link">
            首页
          </a>
        
      
        
          <a href="/archives" class="menu purple-link">
            归档
          </a>
        
      
        
          <a href="https://ev11ccaatt.github.io/post/you-lian/" class="menu purple-link">
            友链
          </a>
        
      
        
          <a href="https://ev11ccaatt.github.io/post/about-me/" class="menu purple-link">
            关于
          </a>
        
      
    </div>
  </div>
</transition>


      <div class="content-container">
        <div class="post-detail">
          
          <h2 class="post-title">DC-9 </h2>
          <div class="post-info post-detail-info">
            <span><i class="icon-calendar-outline"></i> 2021-04-22</span>
            
          </div>
          <div class="post-content">
            <p>dd上来扫一扫<img src="https://raw.githubusercontent.com/ev11ccaatt/mypicture/master/img/image-20210422124211775.png" alt="image-20210422124211775" loading="lazy">没有什么奇怪的东西，那么先去访问一下看下有什么东西。</p>
<p>提供了一个员工表，和一个search页面，怀疑有sql注入之类那么来试试，</p>
<p>分别填入Fred' and 1=1# 和Fred' and 1=2# 对应的分别回显信息，和0 results。</p>
<p>可以判断存在注入，这个看起来不是很难，那就先用sqlmap跑一下</p>
<pre><code>sqlmap -u http://192.168.187.138/results.php --data=&quot;search=1&quot; --dbs
</code></pre>
<figure data-type="image" tabindex="1"><img src="https://raw.githubusercontent.com/ev11ccaatt/mypicture/master/img/image-20210422125635781.png" alt="image-20210422125635781" loading="lazy"></figure>
<p>那么登录看一下</p>
<p><img src="https://raw.githubusercontent.com/ev11ccaatt/mypicture/master/img/image-20210422130458128.png" alt="image-20210422130458128" loading="lazy">在这里可以添加记录，但是试了下没有什么用，这时候看到下方一直是 File does not exist</p>
<p>那么试试有没有LFI，<img src="https://raw.githubusercontent.com/ev11ccaatt/mypicture/master/img/image-20210422130607298.png" alt="image-20210422130607298" loading="lazy"></p>
<p>如图，可以读出相应内容，但是用户太多了，密码也不知道，这时候就要用上前面的sqlmap的另一个库的数据了。</p>
<p>分别把username和password导出来，尝试用hydra来爆破一下,</p>
<figure data-type="image" tabindex="2"><img src="https://raw.githubusercontent.com/ev11ccaatt/mypicture/master/img/image-20210422132445274.png" alt="image-20210422132445274" loading="lazy"></figure>
<p>关闭了22端口</p>
<p>猜测使用了knockd隐藏了22端口，那么我们直接 读下/etc/default/knockd看看存不存在<img src="https://raw.githubusercontent.com/ev11ccaatt/mypicture/master/img/image-20210422133446813.png" alt="image-20210422133446813" loading="lazy"></p>
<p>有提到一个配置文件</p>
<p>读取一下，<img src="https://raw.githubusercontent.com/ev11ccaatt/mypicture/master/img/image-20210422133547921.png" alt="image-20210422133547921" loading="lazy"></p>
<p>得到了敲门顺序，那么用nmap去挨个敲门</p>
<pre><code>nmap -p 7469 192.168.187.138
</code></pre>
<figure data-type="image" tabindex="3"><img src="https://raw.githubusercontent.com/ev11ccaatt/mypicture/master/img/image-20210422134033412.png" alt="image-20210422134033412" loading="lazy"></figure>
<p>这时候就可以用hydra试试爆破了</p>
<figure data-type="image" tabindex="4"><img src="https://raw.githubusercontent.com/ev11ccaatt/mypicture/master/img/image-20210422134929799.png" alt="image-20210422134929799" loading="lazy"></figure>
<p>在janitor发现一个密码本<img src="https://raw.githubusercontent.com/ev11ccaatt/mypicture/master/img/image-20210422135409923.png" alt="image-20210422135409923" loading="lazy">\</p>
<p>用新的密码去打一下看看<img src="https://raw.githubusercontent.com/ev11ccaatt/mypicture/master/img/image-20210422135722390.png" alt="image-20210422135722390" loading="lazy"></p>
<p>在joeyt的home下没找到有用的东西，那么换成fredf试试,试了后也没有什么，那看看有什么免密root执行的</p>
<figure data-type="image" tabindex="5"><img src="https://raw.githubusercontent.com/ev11ccaatt/mypicture/master/img/image-20210422140314200.png" alt="image-20210422140314200" loading="lazy"></figure>
<pre><code>import sys

if len (sys.argv) != 3 :
    print (&quot;Usage: python test.py read append&quot;)
    sys.exit (1)

else :
    f = open(sys.argv[1], &quot;r&quot;)
    output = (f.read())

    f = open(sys.argv[2], &quot;a&quot;)
    f.write(output)
    f.close()
</code></pre>
<p>这就是读一个文件然后以root权限写到另一个文件，那么可以考虑一下直接覆盖root，或者创建一个root权限的用户。</p>
<p><img src="https://raw.githubusercontent.com/ev11ccaatt/mypicture/master/img/image-20210422142739333.png" alt="image-20210422142739333" loading="lazy">这里以本机的来做个参考</p>
<p>那么先创建个<img src="https://raw.githubusercontent.com/ev11ccaatt/mypicture/master/img/image-20210422143256062.png" alt="image-20210422143256062" loading="lazy">，然后<img src="https://raw.githubusercontent.com/ev11ccaatt/mypicture/master/img/image-20210422143654020.png" alt="image-20210422143654020" loading="lazy"></p>
<p>后续我测试的时候没有成功</p>
<p>然后尝试往/etc/passwd写入用户<img src="https://raw.githubusercontent.com/ev11ccaatt/mypicture/master/img/image-20210422144629799.png" alt="image-20210422144629799" loading="lazy"></p>
<p>但是失败了，后面再修。</p>

          </div>
        </div>

        
          <div class="next-post">
            <a class="purple-link" href="https://ev11ccaatt.github.io/post/dc-4/">
              <h3 class="post-title">
                下一篇：DC-4
              </h3>
            </a>
          </div>
          
      </div>

      

      <div class="site-footer">
  <div class="slogan">人菜多学</div>
  <div class="social-container">
    
      
    
      
    
      
    
      
    
      
    
  </div>
  Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | <a class="rss" href="https://ev11ccaatt.github.io/atom.xml" target="_blank">RSS</a>
</div>


    </div>
    <script type="application/javascript">

hljs.initHighlightingOnLoad()

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>




  </body>
</html>
